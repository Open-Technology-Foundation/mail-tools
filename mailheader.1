.TH MAILHEADER 1 "October 2025" "mailheader 1.0" "User Commands"
.SH NAME
mailheader \- extract email headers from mail files
.SH SYNOPSIS
.B mailheader
.I FILE
.SH DESCRIPTION
.B mailheader
reads an email file and outputs everything up to the first blank line (the email headers).
It handles RFC 822 continuation lines by joining lines starting with whitespace to the previous line.
.PP
The utility is available in two forms:
.IP \(bu 2
A standalone binary for general use
.IP \(bu 2
A bash loadable builtin for high-performance scripting (10-20x faster)
.PP
Both implementations provide identical functionality and output.
.SH OPTIONS
.B mailheader
takes no options. It requires exactly one argument: the path to an email file.
.SH EXAMPLES
Extract headers from an email file:
.PP
.RS
.nf
$ mailheader /var/mail/message.eml
From: sender@example.com
To: recipient@example.com
Subject: Test email
Date: Mon, 1 Jan 2025 12:00:00 +0000
.fi
.RE
.PP
Using the builtin in a bash script:
.PP
.RS
.nf
#!/bin/bash
enable -f mailheader.so mailheader 2>/dev/null || true

for email in /var/mail/*.eml; do
  mailheader "$email" | grep "^From:"
done
.fi
.RE
.SH EXIT STATUS
.TP
.B 0
Success
.TP
.B 1
File could not be opened or read, or invalid arguments provided
.SH BASH BUILTIN
When installed, the bash loadable builtin is automatically available in interactive shells.
For non-interactive contexts (scripts, cron jobs), it must be explicitly enabled:
.PP
.RS
.nf
enable -f mailheader.so mailheader 2>/dev/null || true
.fi
.RE
.PP
The builtin provides significant performance benefits by eliminating fork/exec overhead,
making it ideal for scripts that process many email files.
.PP
To view builtin-specific help:
.PP
.RS
.nf
help mailheader
.fi
.RE
.SH PROCESSING DETAILS
.B mailheader
performs the following transformations:
.IP \(bu 2
Stops output at the first blank line (end of headers)
.IP \(bu 2
Joins continuation lines (lines starting with space or tab) with the previous line
.IP \(bu 2
Removes carriage return characters (\\r)
.IP \(bu 2
Converts tab characters to spaces
.SH FILES
.TP
.B /usr/local/bin/mailheader
Standalone binary executable
.TP
.B /usr/local/lib/bash/loadables/mailheader.so
Bash loadable builtin shared object
.TP
.B /etc/profile.d/mail-tools.sh
Profile script that auto-loads the builtin in interactive shells
.SH PERFORMANCE
The standalone binary incurs fork/exec overhead (~1-2ms per call).
The bash builtin runs in-process (~0.1ms per call), providing 10-20x speedup
for scripts processing multiple emails.
.PP
For performance benchmarking:
.PP
.RS
.nf
/usr/share/doc/mailheader/benchmark.sh
/usr/share/doc/mailheader/benchmark_detailed.sh
.fi
.RE
.SH SEE ALSO
.BR formail (1),
.BR reformail (1),
.BR bash (1),
.BR enable (1)
.PP
RFC 822 - Standard for ARPA Internet Text Messages
.SH BUGS
Report bugs at:
.UR https://github.com/Open-Technology-Foundation/mailheader/issues
.UE
.SH AUTHOR
Part of the Open Technology Foundation utilities collection.
.SH COPYRIGHT
Copyright \(co 2025 Free Software Foundation, Inc.
.PP
This is free software; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
.PP
Licensed under the GNU General Public License v3.0 or later.
